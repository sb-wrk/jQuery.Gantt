!function(a,b){"use strict";function c(b,c){var d=new Date(parseInt(c,10));d.setHours(0,0,0,0);var e=a(b).attr("id")||"",f=e.indexOf("-")+1,g=new Date(parseInt(e.substring(f,e.length),10));return g.setHours(0,0,0,0),d.getTime()===g.getTime()}function d(b,c){var d=new Date(parseInt(c,10)),e=d.getFullYear(),f=d.getWeekOfYear(),g=d.getMonth();11===g&&1===f?e++:!g&&f>51&&e--,d=e+"-"+f;var h=a(b).attr("id")||"",i=h.indexOf("-")+1,j=h.substring(i,h.length);return d===j}function e(b,c){var d=new Date(parseInt(c,10));d=d.getFullYear()+"-"+d.getMonth();var e=a(b).attr("id")||"",f=e.indexOf("-")+1,g=e.substring(f,e.length);return d===g}function f(a,b){for(var c=1;;c++){var d=new Date(a);if(d.setHours(a.getHours()+b*c),d.getTime()!==a.getTime())return d}}var g=864e5;a.expr[":"].findday=a.expr.createPseudo?a.expr.createPseudo(function(a){return function(b){return c(b,a)}}):function(a,b,d){return c(a,d[3])},a.expr[":"].findweek=a.expr.createPseudo?a.expr.createPseudo(function(a){return function(b){return d(b,a)}}):function(a,b,c){return d(a,c[3])},a.expr[":"].findmonth=a.expr.createPseudo?a.expr.createPseudo(function(a){return function(b){return e(b,a)}}):function(a,b,c){return e(a,c[3])},Date.prototype.getWeekId=function(){var a=this.getFullYear(),b=this.getWeekOfYear(),c=this.getMonth();return 11===c&&1===b?a++:!c&&b>51&&a--,"dh-"+a+"-"+b},Date.prototype.getRepDate=function(a){switch(a){case"hours":return this.getTime();case"weeks":return this.getDayForWeek().getTime();case"months":return new Date(this.getFullYear(),this.getMonth(),1).getTime();case"days":default:return this.getTime()}},Date.prototype.getDayOfYear=function(){var a=this.getFullYear();return(Date.UTC(a,this.getMonth(),this.getDate())-Date.UTC(a,0,0))/g};var h=1,i=4;Date.prototype.getWeekOfYear=function(){var a=this.getFullYear(),b=this.getMonth(),c=this.getDate(),d=this.getDay(),e=i-d;return h>d&&(e-=7),i-h>e+7&&(e+=7),Math.ceil(new Date(a,b,c+e).getDayOfYear()/7)},Date.prototype.getDayForWeek=function(){var a=this.getDay(),b=(h>a?-7:0)+h-a;return new Date(this.getFullYear(),this.getMonth(),this.getDate()+b)},a.fn.gantt=function(c){var d=["hours","days","weeks","months"],e={source:[],holidays:[],minDate:null,maxDate:null,itemsPerPage:7,dow:["S","M","T","W","T","F","S"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],waitText:"Please wait...",weekYearPrefix:"W",navigate:"buttons",scrollToToday:!0,nav:{page:!0,bounds:!0,week:!0,day:!0,now:!0,zoom:!0},mouseScroll:!0,useCookie:!1,cookieKey:"jquery.fn.gantt",scale:"days",maxScale:"months",minScale:"hours",onItemClick:function(a){},onAddClick:function(a,b){},onRender:a.noop};a.extend(e,c),e.useCookie=e.useCookie&&a.isFunction(a.cookie);var h={elementFromPoint:function(){return"CSS1Compat"===document.compatMode?function(a,b){return a-=window.pageXOffset,b-=window.pageYOffset,document.elementFromPoint(a,b)}:function(b,c){return b-=a(document).scrollLeft(),c-=a(document).scrollTop(),document.elementFromPoint(b,c)}}(),create:function(b){"string"!=typeof e.source?(b.data=e.source,h.init(b)):a.getJSON(e.source,function(a){b.data=a,h.init(b)})},init:function(a){a.rowsNum=a.data.length,a.pageCount=Math.ceil(a.rowsNum/e.itemsPerPage),a.rowsOnLastPage=a.rowsNum-Math.floor(a.rowsNum/e.itemsPerPage)*e.itemsPerPage,a.dateStart=i.getMinDate(a),a.dateEnd=i.getMaxDate(a),h.waitToggle(a,function(){h.render(a)})},render:function(b){var c=a('<div class="fn-content"/>'),d=h.leftPanel(b);c.append(d);var f,g,i=h.rightPanel(b,d);c.append(i),c.append(h.navigation(b));var j=i.find(".dataPanel");if(b.gantt=a('<div class="fn-gantt" />').append(c),a(b).empty().append(b.gantt),b.scrollNavigation.panelMargin=parseInt(j.css("margin-left").replace("px",""),10),b.scrollNavigation.panelMaxPos=j.width()-i.width(),b.scrollNavigation.canScroll=j.width()>i.width(),h.markNow(b),h.fillData(b,j,d),e.useCookie){var k=a.cookie(e.cookieKey+"ScrollPos");k&&(b.hPosition=k)}e.scrollToToday?(h.navigateTo(b,"now"),h.scrollPanel(b,0)):(0!==b.hPosition&&(b.scaleOldWidth&&(f=j.width()-i.width(),g=f*b.hPosition/b.scaleOldWidth,b.hPosition=g>0?0:g,b.scaleOldWidth=null),j.css({"margin-left":b.hPosition}),b.scrollNavigation.panelMargin=b.hPosition),h.repositionLabel(b)),j.css({height:d.height()}),h.waitToggle(b),e.onRender()},leftPanel:function(b){var c=a('<div class="leftPanel"/>').append(a('<div class="row spacer"/>').css("height",i.getCellSize()*b.headerRows).css("width","100%")),d=[];return a.each(b.data,function(a,c){if(a>=b.pageNum*e.itemsPerPage&&a<b.pageNum*e.itemsPerPage+e.itemsPerPage){var f="id"in c?'" data-id="'+c.id:"";d.push('<div class="row name row'+a+(c.desc?"":" fn-wide "+f)+'" id="rowheader'+a+'" data-offset="'+a%e.itemsPerPage*i.getCellSize()+'"><span class="fn-label'+(c.cssClass?" "+c.cssClass:"")+'">'+(c.name||"")+"</span></div>"),c.desc&&d.push('<div class="row desc row'+a+' " id="RowdId_'+a+f+'"><span class="fn-label'+(c.cssClass?" "+c.cssClass:"")+'">'+c.desc+"</span></div>")}}),c.append(d.join(""))},dataPanel:function(c,d){var f=a('<div class="dataPanel" style="width: '+d+'px;"/>');if(e.mouseScroll){var g="onwheel"in c?"wheel":document.onmousewheel!==b?"mousewheel":"DOMMouseScroll";a(c).on(g,function(a){h.wheelScroll(c,a)})}return f.click(function(b){b.stopPropagation();var d,f=a(c).find(".fn-gantt .leftPanel"),g=a(c).find(".fn-gantt .dataPanel");switch(e.scale){case"months":d=i.getCellSize();break;case"hours":d=4*i.getCellSize();break;case"days":d=3*i.getCellSize();break;case"weeks":default:d=2*i.getCellSize()}var j=h.elementFromPoint(b.pageX,g.offset().top+d);j=a("fn-label"===j.className?j.parentNode:j);var k=j.data("repdate"),l=h.elementFromPoint(f.offset().left+f.width()-10,b.pageY);l=a(0===l.className.indexOf("fn-label")?l.parentNode:l);var m=l.data("id");e.onAddClick(k,m)}),f},rightPanel:function(b,c){var d=null,g=["sn","wd","wd","wd","wd","wd","sa"],j=[],k=0,l=[],m=0,n=[],o=0,p=[],q=0,r=[],s=[],t=new Date;t.setHours(0,0,0,0);var u,v,w,x,y,z,A,B,C,D=a('<div class="row header"></div>');switch(e.scale){case"hours":for(d=i.parseTimeRange(b.dateStart,b.dateEnd,b.scaleStep),w=d[0].getFullYear(),x=d[0].getMonth(),z=d[0],u=0,v=d.length;v>u;u++){A=d[u];var E=A.getFullYear();E!==w&&(j.push('<div class="row header year" style="width: '+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),w=E,k=0),k++;var F=A.getMonth();F!==x&&(l.push('<div class="row header month" style="width: '+i.getCellSize()*m+'px"><div class="fn-label">'+e.months[x]+"</div></div>"),x=F,m=0),m++;var G=A.getDay(),H=z.getDay();G!==H&&(B=t-z===0?"today":i.isHoliday(z.getTime())?"holiday":g[H],p.push('<div class="row date '+B+'" style="width: '+i.getCellSize()*q+'px;"><div class="fn-label">'+z.getDate()+"</div></div>"),r.push('<div class="row day '+B+'" style="width: '+i.getCellSize()*q+'px;"><div class="fn-label">'+e.dow[H]+"</div></div>"),z=A,q=0),q++,B=g[G],i.isHoliday(A)&&(B="holiday"),s.push('<div class="row day '+B+'" id="dh-'+A.getTime()+'" data-offset="'+u*i.getCellSize()+'" data-repdate="'+A.getRepDate(e.scale)+'"><div class="fn-label">'+A.getHours()+"</div></div>")}j.push('<div class="row header year" style="width: '+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),l.push('<div class="row header month" style="width: '+i.getCellSize()*m+'px"><div class="fn-label">'+e.months[x]+"</div></div>"),B=g[z.getDay()],i.isHoliday(z)&&(B="holiday"),p.push('<div class="row date '+B+'" style="width: '+i.getCellSize()*q+'px;"><div class="fn-label">'+z.getDate()+"</div></div>"),r.push('<div class="row day '+B+'" style="width: '+i.getCellSize()*q+'px;"><div class="fn-label">'+e.dow[z.getDay()]+"</div></div>"),C=a('<div class="headerPanel" style="width: '+d.length*i.getCellSize()+'px;"/>'),C.append(D.clone().html(j.join("")),D.clone().html(l.join("")),D.clone().html(p.join("")),D.clone().html(r.join("")),D.clone().html(s.join("")));break;case"weeks":d=i.parseWeeksRange(b.dateStart,b.dateEnd),w=d[0].getFullYear(),x=d[0].getMonth(),y=d[0].getWeekOfYear();var I;for(u=0,v=d.length;v>u;u++)A=d[u],y>(y=A.getWeekOfYear())&&(I=A.getDate()-1,I-=A.getMonth()?31:0,I/=7,j.push('<div class="row header year" style="width: '+i.getCellSize()*(k-I)+'px;"><div class="fn-label">'+w+"</div></div>"),w++,k=I),k++,A.getMonth()!==x&&(I=A.getDate()-1,I/=7,l.push('<div class="row header month" style="width:'+i.getCellSize()*(m-I)+'px;"><div class="fn-label">'+e.months[x]+"</div></div>"),x=A.getMonth(),m=I),m++,p.push('<div class="row day wd" id="'+A.getWeekId()+'" data-offset="'+u*i.getCellSize()+'" data-repdate="'+A.getRepDate(e.scale)+'"><div class="fn-label">'+y+"</div></div>");j.push('<div class="row header year" style="width: '+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),l.push('<div class="row header month" style="width: '+i.getCellSize()*m+'px"><div class="fn-label">'+e.months[x]+"</div></div>"),C=a('<div class="headerPanel" style="width: '+d.length*i.getCellSize()+'px;"/>'),C.append(D.clone().html(j.join("")),D.clone().html(l.join("")),D.clone().html(p.join("")));break;case"months":for(d=i.parseMonthsRange(b.dateStart,b.dateEnd),w=d[0].getFullYear(),x=d[0].getMonth(),u=0,v=d.length;v>u;u++)A=d[u],A.getFullYear()!==w&&(j.push('<div class="row header year" style="width: '+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),w=A.getFullYear(),k=0),k++,l.push('<div class="row day wd" id="dh-'+i.genId(A)+'" data-offset="'+u*i.getCellSize()+'" data-repdate="'+A.getRepDate(e.scale)+'">'+(1+A.getMonth())+"</div>");j.push('<div class="row header year" style="width: '+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),l.push('<div class="row header month" style="width: '+i.getCellSize()*m+'px"><div class="fn-label">'+e.months[x]+"</div></div>"),C=a('<div class="headerPanel" style="width: '+d.length*i.getCellSize()+'px;"/>'),C.append(D.clone().html(j.join("")),D.clone().html(l.join("")),D.clone().html(p.join("")),D.clone().html(r.join("")));break;default:d=i.parseDateRange(b.dateStart,b.dateEnd);var J=f(d[0],-1);w=J.getFullYear(),x=J.getMonth();var K=J.getWeekOfYear();for(u=0,v=d.length;v>u;u++)A=d[u],A.getFullYear()!==w&&(j.push('<div class="row header year" style="width:'+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),w=A.getFullYear(),k=0),k++,A.getMonth()!==x&&(l.push('<div class="row header month" style="width:'+i.getCellSize()*m+'px;"><div class="fn-label">'+e.months[x]+"</div></div>"),x=A.getMonth(),m=0),m++,A.getWeekOfYear()!==K&&(n.push('<div class="row header weekyear" style="width:'+i.getCellSize()*o+'px;"><div class="fn-label">'+e.weekYearPrefix+" "+K+"</div></div>"),K=A.getWeekOfYear(),o=0),o++,z=A.getDay(),B=g[z],i.isHoliday(A)&&(B="holiday"),p.push('<div class="row date '+B+'" id="dh-'+i.genId(A)+'" data-offset="'+u*i.getCellSize()+'" data-repdate="'+A.getRepDate(e.scale)+'"><div class="fn-label">'+A.getDate()+"</div></div>"),r.push('<div class="row day '+B+'" id="dw-'+i.genId(A)+'" data-repdate="'+A.getRepDate(e.scale)+'"><div class="fn-label">'+e.dow[z]+"</div></div>");j.push('<div class="row header year" style="width: '+i.getCellSize()*k+'px;"><div class="fn-label">'+w+"</div></div>"),l.push('<div class="row header month" style="width: '+i.getCellSize()*m+'px"><div class="fn-label">'+e.months[x]+"</div></div>"),n.push('<div class="row header weekyear" style="width:'+i.getCellSize()*o+'px;"><div class="fn-label">'+e.weekYearPrefix+" "+K+"</div></div>"),C=a('<div class="headerPanel" style="width: '+d.length*i.getCellSize()+'px;"/>'),C.append(D.clone().html(j.join("")),D.clone().html(l.join("")),D.clone().html(n.join("")),D.clone().html(p.join("")),D.clone().html(r.join("")))}var L=h.dataPanel(b,d.length*i.getCellSize());return L.append(C),a('<div class="rightPanel"></div>').append(L)},navigation:function(b){if(e.nav.page||e.nav.now||e.nav.week||e.nav.day||e.nav.bounds||e.nav.zoom){var c=a('<div class="navigate" />');if("scroll"===e.navigate){var d=a('<div class="nav-slider" />');if(e.nav.page||e.nav.now||e.nav.week||e.nav.day){var f=a('<div class="nav-slider-left" />');e.nav.page&&f.append(a('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){h.navigatePage(b,-1)})).append(a('<div class="page-number"/>').append(a("<span/>").html(b.pageNum+1+" / "+b.pageCount))).append(a('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){h.navigatePage(b,1)})),e.nav.now&&f.append(a('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){h.navigateTo(b,"now")})),e.nav.week&&f.append(a('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){"hours"===e.scale?h.navigateTo(b,8*i.getCellSize()):"days"===e.scale?h.navigateTo(b,30*i.getCellSize()):"weeks"===e.scale?h.navigateTo(b,12*i.getCellSize()):"months"===e.scale&&h.navigateTo(b,6*i.getCellSize())})),e.nav.day&&f.append(a('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){"hours"===e.scale?h.navigateTo(b,4*i.getCellSize()):"days"===e.scale?h.navigateTo(b,7*i.getCellSize()):"weeks"===e.scale?h.navigateTo(b,4*i.getCellSize()):"months"===e.scale&&h.navigateTo(b,3*i.getCellSize())})),d.append(f)}if(e.nav.bounds&&d.append(a('<div class="nav-slider-content" />').append(a('<div class="nav-slider-bar" />').append(a('<a class="nav-slider-button" />')).mousedown(function(a){a.preventDefault(),b.scrollNavigation.scrollerMouseDown=!0,h.sliderScroll(b,a)}).mousemove(function(a){b.scrollNavigation.scrollerMouseDown&&h.sliderScroll(b,a)}))),e.nav.day||e.nav.week||e.nav.zoom){var g=a('<div class="nav-slider-right" />');e.nav.day&&g.append(a('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){"hours"===e.scale?h.navigateTo(b,-4*i.getCellSize()):"days"===e.scale?h.navigateTo(b,-7*i.getCellSize()):"weeks"===e.scale?h.navigateTo(b,-4*i.getCellSize()):"months"===e.scale&&h.navigateTo(b,-3*i.getCellSize())})),e.nav.week&&g.append(a('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){"hours"===e.scale?h.navigateTo(b,-8*i.getCellSize()):"days"===e.scale?h.navigateTo(b,-30*i.getCellSize()):"weeks"===e.scale?h.navigateTo(b,-12*i.getCellSize()):"months"===e.scale&&h.navigateTo(b,-6*i.getCellSize())})),e.nav.zoom&&g.append(a('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){h.zoomInOut(b,-1)})).append(a('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){h.zoomInOut(b,1)})),d.append(g)}c.append(d),a(document).mouseup(function(){b.scrollNavigation.scrollerMouseDown=!1})}else e.nav.page&&c.append(a('<button type="button" class="nav-link nav-page-back"/>').html("&lt;").click(function(){h.navigatePage(b,-1)})).append(a('<div class="page-number"/>').append(a("<span/>").html(b.pageNum+1+" / "+b.pageCount))).append(a('<button type="button" class="nav-link nav-page-next"/>').html("&gt;").click(function(){h.navigatePage(b,1)})),e.nav.bounds&&c.append(a('<button type="button" class="nav-link nav-begin"/>').html("&#124;&lt;").click(function(){h.navigateTo(b,"begin")})),e.nav.week&&c.append(a('<button type="button" class="nav-link nav-prev-week"/>').html("&lt;&lt;").click(function(){h.navigateTo(b,7*i.getCellSize())})),e.nav.day&&c.append(a('<button type="button" class="nav-link nav-prev-day"/>').html("&lt;").click(function(){h.navigateTo(b,i.getCellSize())})),e.nav.now&&c.append(a('<button type="button" class="nav-link nav-now"/>').html("&#9679;").click(function(){h.navigateTo(b,"now")})),e.nav.day&&c.append(a('<button type="button" class="nav-link nav-next-day"/>').html("&gt;").click(function(){h.navigateTo(b,-1*i.getCellSize())})),e.nav.week&&c.append(a('<button type="button" class="nav-link nav-next-week"/>').html("&gt;&gt;").click(function(){h.navigateTo(b,-7*i.getCellSize())})),e.nav.bounds&&c.append(a('<button type="button" class="nav-link nav-end"/>').html("&gt;&#124;").click(function(){h.navigateTo(b,"end")})),e.nav.zoom&&c.append(a('<button type="button" class="nav-link nav-zoomIn"/>').html("&#43;").click(function(){h.zoomInOut(b,-1)})).append(a('<button type="button" class="nav-link nav-zoomOut"/>').html("&#45;").click(function(){h.zoomInOut(b,1)}));return a('<div class="bottom"></div>').append(c)}},createProgressBar:function(b,c,d,f,g){c=c||"";var h=i.getCellSize(),j=i.getProgressBarMargin()||0,k=a('<div class="bar"><div class="fn-label">'+c+"</div></div>").css({width:h*b-j+2}).data("dataObj",g);return d&&k.mouseenter(function(b){var c=a('<div class="fn-gantt-hint" />').html(d);a("body").append(c),c.css("left",b.pageX),c.css("top",b.pageY),c.show()}).mouseleave(function(){a(".fn-gantt-hint").remove()}).mousemove(function(b){a(".fn-gantt-hint").css("left",b.pageX),a(".fn-gantt-hint").css("top",b.pageY+15)}),f&&k.addClass(f),k.click(function(b){b.stopPropagation(),e.onItemClick(a(this).data("dataObj"))}),k},markNow:function(b){var c=(new Date).setHours(0,0,0,0);switch(e.scale){case"weeks":a(b).find(':findweek("'+c+'")').removeClass("wd").addClass("today");break;case"months":a(b).find(':findmonth("'+c+'")').removeClass("wd").addClass("today");break;case"days":case"hours":default:a(b).find(':findday("'+c+'")').removeClass("wd").addClass("today")}},fillData:function(b,c,d){var f=function(a){try{a=a.replace("rgb(","").replace(")","");var b=a.split(","),c=parseInt(b[0],10),d=parseInt(b[1],10),e=parseInt(b[2],10),f=Math.round(.9*(255-(.299*c+.587*d+.114*e)));return"rgb("+f+", "+f+", "+f+")"}catch(g){return""}};a.each(b.data,function(d,j){d>=b.pageNum*e.itemsPerPage&&d<b.pageNum*e.itemsPerPage+e.itemsPerPage&&a.each(j.values,function(j,k){var l,m,n,o,p,q,r,s,t,u;switch(e.scale){case"hours":q=i.genId(i.dateDeserialize(k.from),b.scaleStep),m=a(b).find("#dh-"+q),r=i.genId(i.dateDeserialize(k.to),b.scaleStep),n=a(b).find("#dh-"+r),o=m.data("offset"),p=n.data("offset"),s=Math.floor((p-o)/i.getCellSize())+1,l=h.createProgressBar(s,k.label,k.desc,k.customClass,k.dataObj),t=a(b).find("#rowheader"+d),u=5*i.getCellSize()+2+t.data("offset"),l.css({top:u,left:Math.floor(o)}),c.append(l);break;case"weeks":q=i.dateDeserialize(k.from),r=i.dateDeserialize(k.to),m=a(b).find("#"+q.getWeekId()),o=m.data("offset"),n=a(b).find("#"+r.getWeekId()),p=n.data("offset"),s=Math.round((p-o)/i.getCellSize())+1,l=h.createProgressBar(s,k.label,k.desc,k.customClass,k.dataObj),t=a(b).find("#rowheader"+d),u=3*i.getCellSize()+2+t.data("offset"),l.css({top:u,left:Math.floor(o)}),c.append(l);break;case"months":q=i.dateDeserialize(k.from),r=i.dateDeserialize(k.to),q.getDate()<=3&&0===q.getMonth()&&q.setDate(q.getDate()+4),q.getDate()<=3&&0===q.getMonth()&&q.setDate(q.getDate()+4),r.getDate()<=3&&0===r.getMonth()&&r.setDate(r.getDate()+4),m=a(b).find("#dh-"+i.genId(q)),o=m.data("offset"),n=a(b).find("#dh-"+i.genId(r)),p=n.data("offset"),s=Math.round((p-o)/i.getCellSize())+1,l=h.createProgressBar(s,k.label,k.desc,k.customClass,k.dataObj),t=a(b).find("#rowheader"+d),u=2*i.getCellSize()+2+t.data("offset"),l.css({top:u,left:Math.floor(o)}),c.append(l);break;case"days":default:q=i.genId(i.dateDeserialize(k.from)),r=i.genId(i.dateDeserialize(k.to)),m=a(b).find("#dh-"+q),o=m.data("offset"),s=Math.floor((r-q)/g)+1,l=h.createProgressBar(s,k.label,k.desc,k.customClass,k.dataObj),t=a(b).find("#rowheader"+d),u=5*i.getCellSize()+2+t.data("offset"),l.css({top:u,left:Math.floor(o)}),c.append(l)}var v=l.find(".fn-label");if(v&&l.length){var w=f(l[0].style.backgroundColor);v.css("color",w)}else v&&v.css("color","")})})},navigateTo:function(b,c){var d,e,f=a(b).find(".fn-gantt .rightPanel"),g=f.find(".dataPanel"),i=f.width(),j=g.width(),k=function(){h.repositionLabel(b)};switch(c){case"begin":g.animate({"margin-left":"0px"},"fast",k),b.scrollNavigation.panelMargin=0;break;case"end":var l=j-i;b.scrollNavigation.panelMargin=-1*l,g.animate({"margin-left":"-"+l},"fast",k);break;case"now":if(!b.scrollNavigation.canScroll||!g.find(".today").length)return!1;d=-1*(j-i),e=g.css("margin-left").replace("px",""),c=g.find(".today").offset().left-g.offset().left,c*=-1,c>0?c=0:d>c&&(c=d),g.animate({"margin-left":c},"fast",k),b.scrollNavigation.panelMargin=c;break;default:d=-1*(j-i),e=g.css("margin-left").replace("px",""),c=parseInt(e,10)+c,0>=c&&c>=d&&g.animate({"margin-left":c},"fast",k),b.scrollNavigation.panelMargin=c}h.synchronizeScroller(b)},navigatePage:function(b,c){b.pageNum+c>=0&&b.pageNum+c<Math.ceil(b.rowsNum/e.itemsPerPage)&&h.waitToggle(b,function(){b.pageNum+=c,b.hPosition=a(".fn-gantt .dataPanel").css("margin-left").replace("px",""),b.scaleOldWidth=!1,h.init(b)})},zoomInOut:function(b,c){h.waitToggle(b,function(){var f=0>c,g=b.scaleStep+3*c;g=1>=g?1:4===g?3:g;var i=e.scale,j=b.headerRows;if("hours"===e.scale&&g>=13?(i="days",j=5,g=13):"days"===e.scale&&f?(i="hours",j=5,g=12):"days"!==e.scale||f?"weeks"!==e.scale||f?"weeks"===e.scale&&f?(i="days",j=5,g=13):"months"===e.scale&&f&&(i="weeks",j=3,g=13):(i="months",j=2,g=14):(i="weeks",j=3,g=13),f&&a.inArray(i,d)<a.inArray(e.minScale,d)||!f&&a.inArray(i,d)>a.inArray(e.maxScale,d))return void h.init(b);b.scaleStep=g,e.scale=i,b.headerRows=j;var k=a(b).find(".fn-gantt .rightPanel"),l=k.find(".dataPanel");b.hPosition=l.css("margin-left").replace("px",""),b.scaleOldWidth=l.width()-k.width(),e.useCookie&&(a.cookie(e.cookieKey+"CurrentScale",e.scale),a.cookie(e.cookieKey+"ScrollPos",null)),h.init(b)})},mouseScroll:function(b,c){var d=a(b).find(".fn-gantt .dataPanel");d.css("cursor","move");var e=(d.offset(),null===b.scrollNavigation.mouseX?c.pageX:b.scrollNavigation.mouseX),f=c.pageX-e;b.scrollNavigation.mouseX=c.pageX,h.scrollPanel(b,f),clearTimeout(b.scrollNavigation.repositionDelay),b.scrollNavigation.repositionDelay=setTimeout(h.repositionLabel,50,b)},wheelScroll:function(a,b){b.preventDefault();var c="detail"in b?b.detail:"wheelDelta"in b.originalEvent?-1/120*b.originalEvent.wheelDelta:b.originalEvent.deltaY?b.originalEvent.deltaY/Math.abs(b.originalEvent.deltaY):b.originalEvent.detail;h.scrollPanel(a,-50*c),clearTimeout(a.scrollNavigation.repositionDelay),a.scrollNavigation.repositionDelay=setTimeout(h.repositionLabel,50,a)},sliderScroll:function(b,c){var d,e,f=a(b).find(".nav-slider-bar"),g=f.find(".nav-slider-button"),i=a(b).find(".fn-gantt .rightPanel"),j=i.find(".dataPanel"),k=f.offset(),l=f.width(),m=g.width();if(c.pageX>=k.left&&c.pageX<=k.left+l){d=c.pageX-k.left,d-=m/2,g.css("left",d),e=j.width()-i.width();var n=d*e/l*-1;n>=0?(j.css("margin-left","0px"),b.scrollNavigation.panelMargin=0):d>=l-1*m?(j.css("margin-left",-1*e),b.scrollNavigation.panelMargin=-1*e):(j.css("margin-left",n),b.scrollNavigation.panelMargin=n),clearTimeout(b.scrollNavigation.repositionDelay),b.scrollNavigation.repositionDelay=setTimeout(h.repositionLabel,5,b)}},scrollPanel:function(b,c){if(!b.scrollNavigation.canScroll)return!1;var d=parseInt(b.scrollNavigation.panelMargin,10)+c;d>0?(b.scrollNavigation.panelMargin=0,a(b).find(".fn-gantt .dataPanel").css("margin-left",b.scrollNavigation.panelMargin)):d<-1*b.scrollNavigation.panelMaxPos?(b.scrollNavigation.panelMargin=-1*b.scrollNavigation.panelMaxPos,a(b).find(".fn-gantt .dataPanel").css("margin-left",b.scrollNavigation.panelMargin)):(b.scrollNavigation.panelMargin=d,a(b).find(".fn-gantt .dataPanel").css("margin-left",b.scrollNavigation.panelMargin)),h.synchronizeScroller(b)},synchronizeScroller:function(b){if("scroll"===e.navigate){var c=a(b).find(".fn-gantt .rightPanel"),d=c.find(".dataPanel"),f=a(b).find(".nav-slider-bar"),g=f.find(".nav-slider-button"),h=f.width(),i=g.width(),j=d.width()-c.width(),k=d.css("margin-left")||0;k&&(k=k.replace("px",""));var l=k*h/j-.25*g.width();l=l>0?0:-1*l>=h-.75*i?-1*(h-1.25*i):l,g.css("left",-1*l)}},repositionLabel:function(b){setTimeout(function(){var c;if(b){var d=a(b).find(".fn-gantt .rightPanel");c=d.find(".dataPanel")}else c=a(".fn-gantt .rightPanel .dataPanel");e.useCookie&&a.cookie(e.cookieKey+"ScrollPos",c.css("margin-left").replace("px",""))},500)},waitToggle:function(b,c){if(a.isFunction(c)){var d=a(b);d.offset(),d.outerWidth(),d.outerHeight();b.loader||(b.loader=a('<div class="fn-gantt-loader"><div class="fn-gantt-loader-spinner"><span>'+e.waitText+"</span></div></div>")),d.append(b.loader),setTimeout(c,500)}else b.loader&&b.loader.detach()}},i={getMaxDate:function(b){var c=null;a.each(b.data,function(b,d){a.each(d.values,function(a,b){c=c<i.dateDeserialize(b.to)?i.dateDeserialize(b.to):c})}),c=c||new Date;var d;switch(e.scale){case"hours":c.setHours(Math.ceil(c.getHours()/b.scaleStep)*b.scaleStep),c.setHours(c.getHours()+3*b.scaleStep);break;case"weeks":d=new Date(c.getTime()),d=new Date(d.setDate(d.getDate()+21));var f=7*Math.floor(d.getDate()/7);c=new Date(d.getFullYear(),d.getMonth(),0===f?4:f-3);break;case"months":d=new Date(c.getFullYear(),c.getMonth(),1),d.setMonth(d.getMonth()+2),c=new Date(d.getFullYear(),d.getMonth(),1);break;case"days":default:null==e.maxDate?(c.setHours(0),c.setDate(c.getDate()+3)):c=i.dateDeserialize(e.maxDate)}return c},getMinDate:function(b){var c=null;switch(a.each(b.data,function(b,d){a.each(d.values,function(a,b){c=c>i.dateDeserialize(b.from)||null===c?i.dateDeserialize(b.from):c})}),c=c||new Date,e.scale){case"hours":c.setHours(Math.floor(c.getHours()/b.scaleStep)*b.scaleStep),c.setHours(c.getHours()-3*b.scaleStep);break;case"weeks":var d=new Date(c.getTime());d=new Date(d.setDate(d.getDate()-21));var f=7*Math.floor(d.getDate()/7);c=new Date(d.getFullYear(),d.getMonth(),0===f?4:f-3);break;case"months":c.setHours(0,0,0,0),c.setDate(1),c.setMonth(c.getMonth()-3);break;case"days":default:null==e.minDate?(c.setHours(0,0,0,0),c.setDate(c.getDate()-3)):c=i.dateDeserialize(e.minDate)}return c},parseDateRange:function(a,b){var c=new Date(a.getTime()),d=[],e=0;do d[e++]=new Date(c.getTime()),c.setDate(c.getDate()+1);while(b>=c);return d},parseTimeRange:function(a,b,c){var d=new Date(a),e=new Date(b);d.setHours(0,0,0,0),e.setMilliseconds(0),e.setSeconds(0),(e.getMinutes()>0||e.getHours()>0)&&(e.setMinutes(0),e.setHours(0),e.setTime(e.getTime()+g));for(var h=[],i=0;;){var j=new Date(d);if(j.setHours(Math.floor(d.getHours()/c)*c),h[i]&&j.getDay()!==h[i].getDay()&&j.setHours(0),h[i]=j,d>b)break;d=f(j,c),i++}return h},parseWeeksRange:function(a,b){var c=a.getDayForWeek(),d=[],e=0;do d[e++]=c.getDayForWeek(),c.setDate(c.getDate()+7);while(b>=c);return d},parseMonthsRange:function(a,b){var c=new Date(a),d=(new Date(b),[]),e=0;do d[e++]=new Date(c.getFullYear(),c.getMonth(),1),c.setMonth(c.getMonth()+1);while(b>=c);return d},dateDeserialize:function(b){return"string"==typeof b&&(b=b.replace(/\/Date\((.*)\)\//,"$1"),b=a.isNumeric(b)?parseInt(b,10):a.trim(b)),new Date(b)},genId:function(b){switch(a.isNumeric(b)&&(b=new Date(b)),e.scale){case"hours":var c=b.getHours();return arguments.length>=2&&(c=Math.floor(b.getHours()/arguments[1])*arguments[1]),new Date(b.getFullYear(),b.getMonth(),b.getDate(),c).getTime();case"weeks":var d=b.getFullYear(),f=b.getWeekOfYear(),g=b.getMonth();return 11===g&&1===f?d++:!g&&f>51&&d--,d+"-"+f;case"months":return b.getFullYear()+"-"+b.getMonth();case"days":default:return new Date(b.getFullYear(),b.getMonth(),b.getDate()).getTime()}},_datesToDays:function(a){for(var b,c={},d=0,e=a.length;e>d;d++)b=i.dateDeserialize(a[d]),c[b.setHours(0,0,0,0)]=!0;return c},isHoliday:function(){if(!e.holidays||!e.holidays.length)return function(){return!1};var b=!1;return function(c){return b||(b=i._datesToDays(e.holidays)),!!b[a.isNumeric(c)?c:new Date(c.getFullYear(),c.getMonth(),c.getDate()).getTime()]}}(),getCellSize:function(){if("undefined"==typeof i._getCellSize){var b=a('<div style="display: none; position: absolute;" class="fn-gantt"><div class="row"></div></div>');a("body").append(b),i._getCellSize=b.find(".row").height(),b.empty().remove()}return i._getCellSize},getPageHeight:function(a){return a.pageNum+1===a.pageCount?a.rowsOnLastPage*i.getCellSize():e.itemsPerPage*i.getCellSize()},getProgressBarMargin:function(){if("undefined"==typeof i._getProgressBarMargin){var b=a('<div style="display: none; position: absolute;"><div class="fn-gantt"><div class="rightPanel"><div class="dataPanel"><div class="row day"><div class="bar"></div></div></div></div></div></div>'),c=b.find(".fn-gantt .rightPanel .day .bar");a("body").append(b),i._getProgressBarMargin=parseInt(c.css("margin-left").replace("px",""),10),i._getProgressBarMargin+=parseInt(c.css("margin-right").replace("px",""),10),b.empty().remove()}return i._getProgressBarMargin}};this.each(function(){if(this.data=null,this.pageNum=0,this.pageCount=0,this.rowsOnLastPage=0,this.rowsNum=0,this.hPosition=0,this.dateStart=null,this.dateEnd=null,this.scrollClicked=!1,this.scaleOldWidth=null,this.headerRows=null,e.useCookie){var b=a.cookie(e.cookieKey+"CurrentScale");b?e.scale=b:a.cookie(e.cookieKey+"CurrentScale",e.scale)}switch(e.scale){case"hours":this.headerRows=5,this.scaleStep=1;break;case"weeks":this.headerRows=3,this.scaleStep=13;break;case"months":this.headerRows=2,this.scaleStep=14;break;case"days":default:this.headerRows=5,this.scaleStep=13}this.scrollNavigation={panelMouseDown:!1,scrollerMouseDown:!1,mouseX:null,panelMargin:0,repositionDelay:0,panelMaxPos:0,canScroll:!0},this.gantt=null,this.loader=null,h.create(this)})}}(jQuery);